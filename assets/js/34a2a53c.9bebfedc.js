"use strict";(self.webpackChunkdocusaurus_lms_demo=self.webpackChunkdocusaurus_lms_demo||[]).push([[9599],{12819:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>c,contentTitle:()=>r,default:()=>u,frontMatter:()=>l,metadata:()=>t,toc:()=>o});const t=JSON.parse('{"id":"Features/Atlas Reasoning Engine/stage-4-query-planning","title":"Stage 4 - Query Planning & Execution","description":"Understand how Atlas creates and executes action plans using Large Action Models (LAMs) and APIGen.","source":"@site/genai/Features/3. Atlas Reasoning Engine/stage-4-query-planning.md","sourceDirName":"Features/3. Atlas Reasoning Engine","slug":"/atlas-reasoning-engine/stage-4-query-planning","permalink":"/genai/atlas-reasoning-engine/stage-4-query-planning","draft":false,"unlisted":false,"editUrl":"https://github.com/sf-explorer/documentation/tree/master/genai/Features/3. Atlas Reasoning Engine/stage-4-query-planning.md","tags":[],"version":"current","lastUpdatedAt":1765375009000,"sidebarPosition":7,"frontMatter":{"id":"stage-4-query-planning","slug":"/atlas-reasoning-engine/stage-4-query-planning","title":"Stage 4 - Query Planning & Execution","sidebar_label":"Stage 4: Query Planning","sidebar_position":7,"description":"Understand how Atlas creates and executes action plans using Large Action Models (LAMs) and APIGen.","keywords":["query planning","execution","LAMs","APIGen","parallel execution"]},"sidebar":"genaiSidebar","previous":{"title":"Stage 3: Context Refinement","permalink":"/genai/atlas-reasoning-engine/stage-3-context-refinement"},"next":{"title":"Stage 5: Advanced Retrieval","permalink":"/genai/atlas-reasoning-engine/stage-5-advanced-retrieval"}}');var a=i(74848),s=i(28453);const l={id:"stage-4-query-planning",slug:"/atlas-reasoning-engine/stage-4-query-planning",title:"Stage 4 - Query Planning & Execution",sidebar_label:"Stage 4: Query Planning",sidebar_position:7,description:"Understand how Atlas creates and executes action plans using Large Action Models (LAMs) and APIGen.",keywords:["query planning","execution","LAMs","APIGen","parallel execution"]},r="Stage 4: Query Planning & Execution",c={},o=[{value:"Overview",id:"overview",level:2},{value:"What Happens in This Stage",id:"what-happens-in-this-stage",level:2},{value:"Action Planning Flow",id:"action-planning-flow",level:3},{value:"Components",id:"components",level:2},{value:"1. Large Action Models (LAMs)",id:"1-large-action-models-lams",level:3},{value:"2. APIGen (API Generation)",id:"2-apigen-api-generation",level:3},{value:"Execution Strategies",id:"execution-strategies",level:2},{value:"Parallel Execution",id:"parallel-execution",level:3},{value:"Sequential Execution",id:"sequential-execution",level:3},{value:"Conditional Execution",id:"conditional-execution",level:3},{value:"Real-World Examples",id:"real-world-examples",level:2},{value:"Example 1: Simple Retrieve",id:"example-1-simple-retrieve",level:3},{value:"Example 2: Complex Analysis",id:"example-2-complex-analysis",level:3},{value:"Example 3: Multi-Step Operation",id:"example-3-multi-step-operation",level:3},{value:"Error Handling",id:"error-handling",level:2},{value:"Retry Logic",id:"retry-logic",level:3},{value:"Fallback Strategies",id:"fallback-strategies",level:3},{value:"Partial Results",id:"partial-results",level:3},{value:"Optimization Techniques",id:"optimization-techniques",level:2},{value:"1. Query Optimization",id:"1-query-optimization",level:3},{value:"2. Caching",id:"2-caching",level:3},{value:"3. Batch Operations",id:"3-batch-operations",level:3},{value:"Monitoring",id:"monitoring",level:2},{value:"Performance Considerations",id:"performance-considerations",level:3},{value:"Best Practices",id:"best-practices",level:2},{value:"\u2705 Do&#39;s",id:"-dos",level:3},{value:"\u274c Don&#39;ts",id:"-donts",level:3},{value:"Integration with Stage 5",id:"integration-with-stage-5",level:2},{value:"Related Documentation",id:"related-documentation",level:2}];function d(e){const n={a:"a",admonition:"admonition",br:"br",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",li:"li",mermaid:"mermaid",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,s.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(n.header,{children:(0,a.jsx)(n.h1,{id:"stage-4-query-planning--execution",children:"Stage 4: Query Planning & Execution"})}),"\n",(0,a.jsx)(n.h2,{id:"overview",children:"Overview"}),"\n",(0,a.jsxs)(n.p,{children:["Stage 4 is where Atlas creates an ",(0,a.jsx)(n.strong,{children:"action plan"})," to answer the enriched query and ",(0,a.jsx)(n.strong,{children:"executes"})," the necessary operations using Large Action Models (LAMs) and APIGen."]}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"Processing Time:"})," 300-800ms",(0,a.jsx)(n.br,{}),"\n",(0,a.jsx)(n.strong,{children:"Type:"})," Critical path - Action orchestration",(0,a.jsx)(n.br,{}),"\n",(0,a.jsx)(n.strong,{children:"Purpose:"})," Determine and execute the optimal sequence of actions"]}),"\n",(0,a.jsx)(n.hr,{}),"\n",(0,a.jsx)(n.h2,{id:"what-happens-in-this-stage",children:"What Happens in This Stage"}),"\n",(0,a.jsx)(n.h3,{id:"action-planning-flow",children:"Action Planning Flow"}),"\n",(0,a.jsx)(n.mermaid,{value:"graph TD\n    Input[Enriched Query] --\x3e LAM[Large Action Model]\n    LAM --\x3e Plan[Action Plan Created]\n    \n    Plan --\x3e A1[Identify Required Actions]\n    Plan --\x3e A2[Determine Dependencies]\n    Plan --\x3e A3[Optimize Execution Order]\n    \n    A1 --\x3e Exec[Execute Actions]\n    A2 --\x3e Exec\n    A3 --\x3e Exec\n    \n    Exec --\x3e P1[Parallel Execution]\n    Exec --\x3e S1[Sequential Execution]\n    \n    P1 --\x3e Results[Collect Results]\n    S1 --\x3e Results\n    \n    style Input fill:#f3e5f5\n    style LAM fill:#fff3e0\n    style Plan fill:#e8f5e9\n    style Exec fill:#e3f2fd\n    style Results fill:#c8e6c9"}),"\n",(0,a.jsx)(n.hr,{}),"\n",(0,a.jsx)(n.h2,{id:"components",children:"Components"}),"\n",(0,a.jsx)(n.h3,{id:"1-large-action-models-lams",children:"1. Large Action Models (LAMs)"}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"What LAMs Do:"})}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"Analyze the enriched query and context"}),"\n",(0,a.jsx)(n.li,{children:"Determine which actions are needed"}),"\n",(0,a.jsx)(n.li,{children:"Plan the sequence of operations"}),"\n",(0,a.jsx)(n.li,{children:"Handle dependencies between actions"}),"\n",(0,a.jsx)(n.li,{children:"Optimize for parallel execution"}),"\n"]}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"Example LAM Decision:"})}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-javascript",children:'Query: "What\'s the best next action for this opportunity?"\n\nLAM Analysis:\n{\n  requiredActions: [\n    "GetOpportunityDetails",\n    "GetSimilarWonOpportunities",\n    "AnalyzeClosingPatterns",\n    "RecommendNextBestAction"\n  ],\n  dependencies: {\n    "AnalyzeClosingPatterns": ["GetOpportunityDetails", "GetSimilarWonOpportunities"],\n    "RecommendNextBestAction": ["AnalyzeClosingPatterns"]\n  },\n  parallelizable: ["GetOpportunityDetails", "GetSimilarWonOpportunities"]\n}\n'})}),"\n",(0,a.jsx)(n.h3,{id:"2-apigen-api-generation",children:"2. APIGen (API Generation)"}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"What APIGen Does:"})}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"Generates API calls dynamically"}),"\n",(0,a.jsx)(n.li,{children:"Optimizes query parameters"}),"\n",(0,a.jsx)(n.li,{children:"Handles error cases and retries"}),"\n",(0,a.jsx)(n.li,{children:"Transforms data formats"}),"\n",(0,a.jsx)(n.li,{children:"Manages rate limits"}),"\n"]}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"Example APIGen Output:"})}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-javascript",children:'{\n  actions: [\n    {\n      type: "SOQL_QUERY",\n      query: "SELECT Id, Name, StageName, Amount FROM Opportunity WHERE Id = \'OPP-12345\'",\n      timeout: 5000\n    },\n    {\n      type: "REST_API",\n      endpoint: "/services/data/v59.0/sobjects/Opportunity/OPP-12345",\n      method: "GET",\n      headers: {"Authorization": "Bearer ..."}\n    }\n  ]\n}\n'})}),"\n",(0,a.jsx)(n.hr,{}),"\n",(0,a.jsx)(n.h2,{id:"execution-strategies",children:"Execution Strategies"}),"\n",(0,a.jsx)(n.h3,{id:"parallel-execution",children:"Parallel Execution"}),"\n",(0,a.jsx)(n.p,{children:"When actions are independent, they run simultaneously:"}),"\n",(0,a.jsx)(n.mermaid,{value:"gantt\n    title Parallel Execution Example\n    dateFormat SSS\n    axisFormat %L ms\n    \n    section Planning\n    Query Analysis                  :done, analysis, 000, 500ms\n    Action Plan Creation            :active, plan, after analysis, 1000ms\n    \n    section Parallel Actions\n    GetOpportunityDetails           :crit, a1, after plan, 2000ms\n    GetSimilarWonOpportunities      :crit, a2, after plan, 2000ms\n    \n    section Sequential Actions\n    AnalyzeClosingPatterns          :active, a3, after a1, 1500ms\n    RecommendNextBestAction         :done, a4, after a3, 1000ms\n    \n    section Result\n    Return Recommendation           :milestone, done, after a4, 0ms"}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"Time Saved:"})," 2000ms (parallel) vs 4000ms (sequential) = ",(0,a.jsx)(n.strong,{children:"50% faster"})]}),"\n",(0,a.jsx)(n.h3,{id:"sequential-execution",children:"Sequential Execution"}),"\n",(0,a.jsx)(n.p,{children:"When actions depend on each other, they run in order:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{children:"Action 1: Get Account Details\n   \u2193\nAction 2: Get Related Contacts (needs Account ID)\n   \u2193\nAction 3: Get Contact Activities (needs Contact IDs)\n   \u2193\nResult: Complete Activity Report\n"})}),"\n",(0,a.jsx)(n.h3,{id:"conditional-execution",children:"Conditional Execution"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-javascript",children:'plan = {\n  action1: "CheckAccountType",\n  conditionalActions: {\n    if_premium: ["AssignPremiumSupport", "SetHighPriority"],\n    if_standard: ["AssignStandardSupport", "SetNormalPriority"]\n  }\n}\n'})}),"\n",(0,a.jsx)(n.hr,{}),"\n",(0,a.jsx)(n.h2,{id:"real-world-examples",children:"Real-World Examples"}),"\n",(0,a.jsx)(n.h3,{id:"example-1-simple-retrieve",children:"Example 1: Simple Retrieve"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{children:'Query: "Show me account details for Acme Corp"\n\nAction Plan:\n1. GetAccountByName("Acme Corp")\n\nExecution:\n- Single SOQL query\n- No dependencies\n- Fast execution (200ms)\n'})}),"\n",(0,a.jsx)(n.h3,{id:"example-2-complex-analysis",children:"Example 2: Complex Analysis"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{children:'Query: "What\'s the health score for my top 10 accounts?"\n\nAction Plan:\n1. [Parallel] GetMyAccounts (top 10 by revenue)\n2. [Parallel for each account]:\n   - GetOpenOpportunities\n   - GetOpenCases\n   - GetRecentOrders\n   - GetEngagementScore\n3. [Sequential] CalculateHealthScore (aggregate results)\n4. [Sequential] RankAccounts\n5. [Sequential] FormatResults\n\nExecution:\n- 1 account query\n- 40 parallel queries (10 accounts \xd7 4 metrics)\n- 3 sequential calculations\n- Total time: 800ms (vs 2000ms sequential)\n'})}),"\n",(0,a.jsx)(n.h3,{id:"example-3-multi-step-operation",children:"Example 3: Multi-Step Operation"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{children:'Query: "Create a case for Tesla and assign to the right team"\n\nAction Plan:\n1. GetAccountByName("Tesla")\n2. DetermineAccountTier (from account data)\n3. [Conditional based on tier]:\n   If Premium \u2192 AssignToPremiumTeam\n   If Standard \u2192 AssignToStandardTeam\n4. CreateCase (with determined owner)\n5. SendNotification (to assigned team)\n\nExecution:\n- Sequential (each step depends on previous)\n- Total time: 600ms\n'})}),"\n",(0,a.jsx)(n.hr,{}),"\n",(0,a.jsx)(n.h2,{id:"error-handling",children:"Error Handling"}),"\n",(0,a.jsx)(n.h3,{id:"retry-logic",children:"Retry Logic"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-javascript",children:'executionConfig = {\n  maxRetries: 3,\n  retryDelay: [100ms, 500ms, 1000ms], // exponential backoff\n  retryableErrors: ["TIMEOUT", "RATE_LIMIT", "TEMPORARY_ERROR"]\n}\n'})}),"\n",(0,a.jsx)(n.h3,{id:"fallback-strategies",children:"Fallback Strategies"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-javascript",children:'if (action "GetSimilarOpportunities" fails) {\n  fallback: "GetRecentOpportunities"\n}\n\nif (external_api_call fails) {\n  fallback: "UseCachedData"\n}\n'})}),"\n",(0,a.jsx)(n.h3,{id:"partial-results",children:"Partial Results"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-javascript",children:"// If some parallel actions fail, return partial results\nresults = {\n  successful: [action1Result, action2Result],\n  failed: [action3Error],\n  partial: true,\n  confidence: 0.7\n}\n"})}),"\n",(0,a.jsx)(n.hr,{}),"\n",(0,a.jsx)(n.h2,{id:"optimization-techniques",children:"Optimization Techniques"}),"\n",(0,a.jsx)(n.h3,{id:"1-query-optimization",children:"1. Query Optimization"}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"Before Optimization:"})}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-sql",children:"-- 3 separate queries\nSELECT Id, Name FROM Account WHERE Id = '001...'\nSELECT COUNT() FROM Opportunity WHERE AccountId = '001...'\nSELECT COUNT() FROM Case WHERE AccountId = '001...'\n"})}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"After Optimization:"})}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-sql",children:"-- 1 query with subqueries\nSELECT \n  Id, Name,\n  (SELECT COUNT() FROM Opportunities) as OpptyCount,\n  (SELECT COUNT() FROM Cases) as CaseCount\nFROM Account \nWHERE Id = '001...'\n"})}),"\n",(0,a.jsx)(n.h3,{id:"2-caching",children:"2. Caching"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-javascript",children:"// Cache expensive computations\nif (cache.has(`account_health:${accountId}`)) {\n  return cache.get(`account_health:${accountId}`);\n}\n\nconst healthScore = await calculateHealthScore(accountId);\ncache.set(`account_health:${accountId}`, healthScore, ttl=5min);\n"})}),"\n",(0,a.jsx)(n.h3,{id:"3-batch-operations",children:"3. Batch Operations"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-javascript",children:"// Instead of 100 individual API calls\nfor (account of accounts) {\n  await updateAccount(account);\n}\n\n// Batch into single call\nawait batchUpdateAccounts(accounts); // 100x faster\n"})}),"\n",(0,a.jsx)(n.hr,{}),"\n",(0,a.jsx)(n.h2,{id:"monitoring",children:"Monitoring"}),"\n",(0,a.jsx)(n.h3,{id:"performance-considerations",children:"Performance Considerations"}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"Typical Query Planning Performance:"})}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Processing Time:"})," 400-800ms per request"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Actions Per Query:"})," 2-5 actions on average"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Parallel Execution Rate:"})," 50-70% of eligible actions"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Action Success Rate:"})," 90-95% with proper error handling"]}),"\n"]}),"\n",(0,a.jsx)(n.admonition,{type:"note",children:(0,a.jsxs)(n.p,{children:["Monitor your agent's performance through ",(0,a.jsx)(n.strong,{children:"Setup \u2192 Einstein \u2192 Einstein for Service"}),". Salesforce provides built-in analytics for action execution and query optimization."]})}),"\n",(0,a.jsx)(n.hr,{}),"\n",(0,a.jsx)(n.h2,{id:"best-practices",children:"Best Practices"}),"\n",(0,a.jsx)(n.h3,{id:"-dos",children:"\u2705 Do's"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"\u2705 Identify independent actions for parallel execution"}),"\n",(0,a.jsx)(n.li,{children:"\u2705 Use batch operations when possible"}),"\n",(0,a.jsx)(n.li,{children:"\u2705 Implement retry logic for transient failures"}),"\n",(0,a.jsx)(n.li,{children:"\u2705 Cache expensive computations"}),"\n",(0,a.jsx)(n.li,{children:"\u2705 Optimize SOQL queries"}),"\n"]}),"\n",(0,a.jsx)(n.h3,{id:"-donts",children:"\u274c Don'ts"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"\u274c Execute all actions sequentially"}),"\n",(0,a.jsx)(n.li,{children:"\u274c Make individual API calls in loops"}),"\n",(0,a.jsx)(n.li,{children:"\u274c Ignore rate limits"}),"\n",(0,a.jsx)(n.li,{children:"\u274c Skip error handling"}),"\n",(0,a.jsx)(n.li,{children:"\u274c Over-complicate action plans"}),"\n"]}),"\n",(0,a.jsx)(n.hr,{}),"\n",(0,a.jsx)(n.h2,{id:"integration-with-stage-5",children:"Integration with Stage 5"}),"\n",(0,a.jsxs)(n.p,{children:["Action results move to ",(0,a.jsx)(n.a,{href:"./stage-5-advanced-retrieval",children:"Stage 5: Advanced Retrieval"}),":"]}),"\n",(0,a.jsx)(n.mermaid,{value:"graph LR\n    S3[Stage 3: Context] --\x3e S4[Stage 4: Planning]\n    S4 --\x3e|Action Results| S5[Stage 5: Retrieval]\n    \n    style S3 fill:#f3e5f5\n    style S4 fill:#e8f5e9\n    style S5 fill:#fff3e0"}),"\n",(0,a.jsx)(n.hr,{}),"\n",(0,a.jsx)(n.h2,{id:"related-documentation",children:"Related Documentation"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:(0,a.jsx)(n.a,{href:"./stage-3-context-refinement",children:"Stage 3: Context Refinement"})})," - Previous stage"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:(0,a.jsx)(n.a,{href:"./stage-5-advanced-retrieval",children:"Stage 5: Advanced Retrieval"})})," - Next stage"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:(0,a.jsx)(n.a,{href:"../",children:"Complete Pipeline"})})," - All stages overview"]}),"\n"]}),"\n",(0,a.jsx)(n.hr,{}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"Stage 4 is the critical path where Atlas orchestrates intelligent action execution, optimizing for both speed and accuracy through parallel processing and smart planning."})})]})}function u(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,a.jsx)(n,{...e,children:(0,a.jsx)(d,{...e})}):d(e)}},28453:(e,n,i)=>{i.d(n,{R:()=>l,x:()=>r});var t=i(96540);const a={},s=t.createContext(a);function l(e){const n=t.useContext(s);return t.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function r(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:l(e.components),t.createElement(s.Provider,{value:n},e.children)}}}]);